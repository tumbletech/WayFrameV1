<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>WayFrame | Available Stays</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"/>
<style>
  body{background:#f5f7fb}
  .card{border-radius:16px}
  .badge-dot{background:#e9f5eb;color:#237a3b;border:1px solid #cde9d6}
  .pill{background:#eef5ff;color:#0b5ed7;border:1px solid #cfe2ff;border-radius:999px;padding:.25rem .6rem;font-weight:600}
  .muted{color:#6b7280}
  .thumb{width:100%;height:160px;object-fit:cover;border-radius:12px;background:linear-gradient(135deg,#e5ecff,#f5f7fb)}
  .sticky-top{top:0.75rem !important}
  .hotel-name{word-break:break-word}
</style>
</head>
<body>
<div class="container py-3">

  <!-- Header -->
  <div class="d-flex flex-wrap align-items-center justify-content-between gap-2 mb-3">
    <div>
      <h1 class="h5 mb-1">Available Stays</h1>
      <div id="destLine" class="muted small"></div>
    </div>
    <a href="module4.html" class="pill text-decoration-none">Edit filters</a>
  </div>

  <div class="row g-3">
    <!-- Sidebar -->
    <div class="col-12 col-lg-3">
      <div class="card p-3 sticky-top">
        <div class="fw-semibold mb-2">Your criteria</div>
        <div id="crit" class="small"></div>
        <hr>
        <small class="text-muted">
          Establishments are from the
          <a href="https://tourism.gov.ph/accreditations/accredited" target="_blank" rel="noopener">DOT star-rated list</a>.
        </small>
      </div>
    </div>

    <!-- Results -->
    <div class="col-12 col-lg-9">
      <div id="scopeNote" class="alert alert-info py-2 px-3 small d-none"></div>
      <div id="list" class="row g-3"></div>
      <div id="empty" class="text-center text-muted py-5 d-none">No DOT-listed stays match your destination.</div>
    </div>
  </div>
</div>

<script>
  // --------------------------
  // DOT star-rated establishments (as of June 30, 2025)
  // --------------------------
  const accommodations = [
    { region: "NCR", name: "DIAMOND HOTEL PHILIPPINES", rating: "5 STAR", category: "HOTEL", validity: "2027-10-31" },
    { region: "NCR", name: "HYATT CITY OF DREAMS", rating: "5 STAR", category: "HOTEL", validity: "2026-10-31" },
    { region: "NCR", name: "JOY-NOSTALG HOTEL AND SUITES MANILA", rating: "5 STAR", category: "HOTEL", validity: "2027-10-31" },
    { region: "NCR", name: "NUWA HOTEL", rating: "5 STAR", category: "HOTEL", validity: "2026-10-31" },
    { region: "NCR", name: "OKADA MANILA", rating: "5 STAR", category: "HOTEL", validity: "2026-10-31" },
    { region: "NCR", name: "SHANGRI-LA THE FORT MANILA", rating: "5 STAR", category: "HOTEL", validity: "2027-10-31" },
    { region: "NCR", name: "SOLAIRE RESORT NORTH", rating: "5 STAR", category: "HOTEL", validity: "2027-10-31" },
    { region: "NCR", name: "THE MANILA HOTEL", rating: "5 STAR", category: "HOTEL", validity: "2027-10-31" },
    { region: "NCR", name: "THE WESTIN HOTEL", rating: "5 STAR", category: "HOTEL", validity: "2027-10-31" },
    { region: "NCR", name: "KINGSFORD HOTEL MANILA", rating: "4 STAR", category: "HOTEL", validity: "2027-10-31" },
    { region: "NCR", name: "SEDA BONIFACIO GLOBAL CITY", rating: "4 STAR", category: "HOTEL", validity: "2027-10-31" },
    { region: "NCR", name: "SOMERSET CENTRAL SALCEDO MAKATI", rating: "4 STAR", category: "APARTMENT HOTEL", validity: "2027-10-31" },
    { region: "NCR", name: "MANILA GRAND OPERA HOTEL", rating: "3 STAR", category: "HOTEL", validity: "2027-10-31" },
    { region: "NCR", name: "ACE HOTEL AND SUITES", rating: "3 STAR", category: "HOTEL", validity: "2027-10-31" },

    { region: "Region 4A", name: "AQUARIA WATERPARK AND CRUSOE CABINS", rating: "4 STAR", category: "RESORT", validity: "2027-10-31" },
    { region: "Region 4A", name: "PALM BEACH RESORT", rating: "4 STAR", category: "RESORT", validity: "2027-10-31" },
    { region: "Region 4A", name: "HOTEL KIMBERLY TAGAYTAY", rating: "3 STAR", category: "HOTEL", validity: "2027-10-31" },
    { region: "Region 4A", name: "JET HOTEL", rating: "3 STAR", category: "HOTEL", validity: "2027-10-31" },
    { region: "Region 4A", name: "CIUDAD CHRISTHIA RESORT", rating: "2 STAR", category: "RESORT", validity: "2027-10-31" },

    { region: "Region 4B", name: "SEDA LIO", rating: "4 STAR", category: "RESORT", validity: "2027-10-31" },

    { region: "Region 5", name: "MISIBIS BAY RESORT", rating: "4 STAR", category: "RESORT", validity: "2027-10-31" },
    { region: "Region 5", name: "THE ORIENTAL LEGAZPI", rating: "4 STAR", category: "HOTEL", validity: "2027-10-31" },
    { region: "Region 5", name: "THE MARISON HOTEL", rating: "3 STAR", category: "HOTEL", validity: "2027-10-31" },
    { region: "Region 5", name: "THE ORIENTAL HOSPITALITY AND RESTAURANT MANAGEMENT SERVICES, INC. (PROXY BY THE ORIENTAL)", rating: "3 STAR", category: "HOTEL", validity: "2027-10-31" },

    { region: "Region 6", name: "CRIMSON RESORT AND SPA BORACAY", rating: "5 STAR", category: "RESORT", validity: "2027-10-31" },
    { region: "Region 6", name: "DAYS HOTEL BY WYNDHAM ILOILO", rating: "3 STAR", category: "HOTEL", validity: "2027-10-31" },

    { region: "Region 7", name: "KANDAYA RESORT", rating: "5 STAR", category: "RESORT", validity: "2027-10-31" },
    { region: "Region 7", name: "MAAYO HOTEL", rating: "4 STAR", category: "HOTEL", validity: "2027-10-31" },
    { region: "Region 7", name: "SEDA CENTRAL BLOC CEBU", rating: "4 STAR", category: "HOTEL", validity: "2027-10-31" },

    { region: "Region 12", name: "AVIOR HOTEL", rating: "2 STAR", category: "HOTEL", validity: "2027-10-31" }
  ];

  // --------------------------
  // Read destination + criteria
  // --------------------------
  const dest = JSON.parse(localStorage.getItem('wf_destination') || '{}');
  const crit = JSON.parse(localStorage.getItem('wf_accomCriteria') || '{}');

  // Guard
  if (!dest || (!dest.city && !(dest.lat && dest.lng))) {
    alert('Please pick a destination first.');
    location.href = 'module2.html';
  }

  // Header
  const destLine = document.getElementById('destLine');
  destLine.textContent =
    dest.city
      ? `Near ${dest.city}${dest.province ? ', ' + dest.province : ''}${dest.region ? ', ' + dest.region : ''}`
      : `Near your selected pin (${dest.lat?.toFixed(3)}, ${dest.lng?.toFixed(3)})`;

  const critBox = document.getElementById('crit');
  critBox.innerHTML = `
    <div><strong>Type:</strong> ${crit.type || 'Any'}</div>
    <div><strong>Max price:</strong> ${crit.maxPrice ? '≤ ' + toPeso(crit.maxPrice) : 'Any'}</div>
    <div><strong>Room size:</strong> ${crit.roomSize || 'Any'}</div>
    <div><strong>Beds:</strong> ${crit.beds || 'Any'}</div>
  `;

  // Region normalization (same logic as module4)
  function normalizeRegionKey(regionStr=''){
    const s = (regionStr || '').toLowerCase();
    if (s.includes('ncr') || s.includes('metro manila')) return 'NCR';
    if (s.includes('iv-a') || s.includes('4a') || s.includes('calabarzon')) return 'Region 4A';
    if (s.includes('iv-b') || s.includes('4b') || s.includes('mimaropa')) return 'Region 4B';
    if (s.includes('region 5') || s.includes('bicol')) return 'Region 5';
    if (s.includes('region 6') || s.includes('western visayas')) return 'Region 6';
    if (s.includes('region 7') || s.includes('central visayas')) return 'Region 7';
    if (s.includes('region 12') || s.includes('soccsksargen')) return 'Region 12';
    if (/^region\s*\d{1,2}[ab]?$/i.test(regionStr?.trim())) return regionStr.trim();
    if ((regionStr||'').trim().toUpperCase() === 'NCR') return 'NCR';
    return regionStr || null;
  }
  const regionKey = crit.regionKey || normalizeRegionKey(dest.region);

  // Scope note
  const note = document.getElementById('scopeNote');
  if (regionKey) {
    note.classList.remove('d-none');
    note.textContent = `Showing DOT star-rated establishments in ${regionKey}.`;
  }

  // Filter first by region (strict), then by user's type (optional)
  const regionFiltered = (regionKey)
    ? accommodations.filter(h => h.region === regionKey)
    : [];

  const finalList = regionFiltered.filter(h => {
    if (!crit.type) return true;
    return h.category.toLowerCase() === crit.type.toLowerCase();
  });

  renderList(finalList);

  // Helpers
  function toPeso(n){ return '₱' + Number(n).toLocaleString('en-PH'); }
  function googleSearchUrl(name, dest){
    const q = [name, dest?.city, dest?.province, dest?.region, 'Philippines', 'booking'].filter(Boolean).join(' ');
    return 'https://www.google.com/search?q=' + encodeURIComponent(q);
  }

  function renderList(items){
    const list = document.getElementById('list');
    const empty = document.getElementById('empty');
    list.innerHTML = '';

    if (!items.length){
      empty.classList.remove('d-none');
      return;
    }
    empty.classList.add('d-none');

    items.forEach(h => {
      const col = document.createElement('div');
      col.className = 'col-12';
      const validity = h.validity ? new Date(h.validity).toLocaleDateString('en-PH', { year:'numeric', month:'long', day:'2-digit' }) : '—';

      col.innerHTML = `
        <div class="card p-3">
          <div class="row g-3 align-items-center">
            <div class="col-12 col-md-4">
              <div class="thumb d-flex align-items-center justify-content-center text-muted">
                <span class="small">No image yet</span>
              </div>
            </div>
            <div class="col-12 col-md-8">
              <div class="d-flex align-items-center justify-content-between flex-wrap gap-2">
                <h2 class="h6 mb-0 hotel-name">${h.name}</h2>
                <span class="badge badge-dot">DOT Accredited</span>
              </div>
              <div class="small mt-1">
                <strong>${h.rating}</strong> • ${h.category} • ${h.region}
              </div>
              <div class="small muted">Accreditation valid until: ${validity}</div>

              <div class="d-flex gap-2 mt-3 flex-wrap">
                <a class="btn btn-outline-primary btn-sm" href="${googleSearchUrl(h.name, dest)}" target="_blank" rel="noopener">Check availability</a>
                <button class="btn btn-primary btn-sm" data-name="${h.name}">Add to plan</button>
              </div>
            </div>
          </div>
        </div>
      `;
      col.querySelector('button.btn-primary').addEventListener('click', () => addToPlan(h));
      list.appendChild(col);
    });
  }

  function addToPlan(h){
    const arr = JSON.parse(localStorage.getItem('wf_stays') || '[]');
    arr.push({
      name: h.name,
      region: h.region,
      rating: h.rating,
      category: h.category,
      validity: h.validity || null,
      addedAt: Date.now()
    });
    localStorage.setItem('wf_stays', JSON.stringify(arr));

    const progress = JSON.parse(localStorage.getItem('wf_progress') || '{}');
    localStorage.setItem('wf_progress', JSON.stringify({ ...progress, m4_added: true }));

    alert(`Added "${h.name}" to your plan.`);
  }
</script>
</body>
</html>
